<div class="wd">
    <p-table #dt [columns]="cols" [exportFilename]="fileName+'_Report'" [value]="entirerecords" [customSort]="true"
        [paginator]="false" [rows]="10" [lazy]="true" (onLazyLoad)="lazyload($event);" [totalRecords]="total"
        [loading]="false" [tableStyle]="{ 'min-width': '50rem' }" [globalFilterFields]="searchableColumns"
        responsiveLayout="scroll">
        <ng-template pTemplate="caption" style="display: flex;">
            <div class="col-6" style="padding: 0px;">
                <button type="button" pButton pRipple icon="pi pi-file" (click)="dt.exportCSV()" class="mr-2"
                    pTooltip="CSV" tooltipPosition="bottom"></button>
                <!-- <button type="button" pButton pRipple icon="pi pi-file-excel" (click)="exportExcel()"
                    class="p-button-success mr-2 " pTooltip="XLS" tooltipPosition="bottom"></button> -->
                <button type="button" pButton pRipple icon="pi pi-file-pdf" (click)="exportPdf()"
                    class="p-button-warning mr-2 " pTooltip="PDF" tooltipPosition="bottom"></button>
                <!-- <button type="button" pButton pRipple icon="pi pi-filter"
                    (click)="dt.exportCSV({ selectionOnly: true })" class=" mr-2 p-button-info ml-auto"
                    pTooltip="Selection Only" tooltipPosition="bottom"></button> -->

            </div>
            <div class="col-2" style="padding: 0px;">
                <div class="col" *ngIf="hasActiveInactive; else elsep" style="text-align: end;padding: 0px;
                margin-right: 10px;">
                    <p-toggleButton [(ngModel)]="defaultstatus" [onLabel]="onLabel" [offLabel]="offLabel"
                        [style]="{'width': '10em'}" (onChange)="changeEvent($event)"></p-toggleButton>
                </div>
                <ng-template #elsep>
                    <div class="col" style="padding: 0px;"></div>
                </ng-template>
            </div>
            <div class="col-4" style="padding: 0px;">
                <input class="p-inputtext p-component p-element w-full" [(ngModel)]="searchString"
                    (change)="onGlobalFilter($event)" placeholder="Search Keyword and Click Enter" />

            </div>
        </ng-template>
        <ng-template pTemplate="header" let-columns>
            <tr>
                <th *ngIf="canShowAction">Action </th>
                <th *ngFor="let col of columns" [pSortableColumn]="col.sortablefield" style="text-wrap: nowrap;">
                    {{col.header | titlecase}}
                    <p-sortIcon *ngIf="col.sortablefield" [field]="col.sortablefield"></p-sortIcon>
                </th>
            </tr>
          <!--  <tr>
              <th *ngIf="canShowAction"></th>
                  <th *ngFor="let col of columns">
                    <div *ngIf="col.field==='lastUpdatedDate'||col.field ==='createdDate';else columsfwwiletr">

                    </div>
                    <ng-template #columsfwwiletr>
                        <div *ngIf="col.field==='startDate'||col.field==='endDate' ; else columfiletr">

                             <p-columnFilter [field]="col.sortablefield" matchMode="equals" [showMenu]="false">
                                <ng-template pTemplate="filter" let-value let-filter="filterCallback">
                                    <p-calendar [showIcon]="true" view="month" dateFormat="yy/mm"
                                        (onSelect)="filter($event)" inputId="icon"></p-calendar>
                                </ng-template></p-columnFilter> 
                        </div>
                    </ng-template>
                    <ng-template #columfiletr>
                        <p-columnFilter type="text" matchMode="in" [showMenu]="false"
                            [field]="col.sortablefield"></p-columnFilter>
                    </ng-template>
                </th>
            </tr> -->
        </ng-template>
        <ng-template pTemplate="body" let-rowData let-columns="columns">
            <tr [pSelectableRow]="rowData">

                <td class="dttable" *ngIf="canShowAction" style="display: flex;">
                    <ng-container *ngFor="let action of actions">
                        <div *ngIf="action.isIcon; else buttn">

                            <button type="button" style="background-color: aliceblue;"
                                *ngIf="(action.visibilityCheckFeild? rowData[action.visibilityCheckFeild] : true) && getPerm(action.privilege)"
                                pButton pRipple [icon]="action.icon" (click)="makeAction(action.type,rowData,$event )"
                                class=" mr-2  p-element p-ripple p-button p-button p-button-outlined p-button p-component p-button"
                                [title]="action.title"></button>

                        </div>
                        <ng-template #buttn>

                            <button pButton pRipple type="button"
                                *ngIf="action.visibilityCheckFeild? rowData[action.visibilityCheckFeild] : true"
                                (click)="makeAction(action.type,rowData,$event )" [label]="action.title"
                                class=" mr-2  p-element p-ripple p-button p-button p-button-outlined p-button p-component p-button"></button>
                        </ng-template>
                    </ng-container>
                </td>
                <td *ngFor="let col of columns" class="dttable">
                    <div *ngIf="col.isProgress; else noprog">
                        <div class="row">
                            <div class="col-9" style="padding: 10px 0px 0px 0px;">
                                <p-progressBar [value]="rowData[col.field]" [showValue]="false"
                                    [color]="getcolorforProgress(rowData[col.field],col.field )"></p-progressBar>
                            </div>
                            <div class="col-3" style="padding: 10px 0px 0px 0px;">{{ rowData[col.field] | round}} %
                            </div>
                        </div>
                    </div>
                    <ng-template #noprog>
                        <div
                            *ngIf="col.field==='lastUpdatedDate' ||col.field==='createdDate' ||col.field==='startDate'||col.field==='endDate' ; else elspe">
                            {{ dc(rowData[col.field],col.field )}}
                        </div>
                        <ng-template #elspe>
                            <div *ngIf="col.isLink; else link">
                                <a target="_blank" [title]="rowData[col.field]" [href]="rowData[col.field]">
                                    Link
                                </a>
                            </div>

                            <ng-template #link>
                                <div *ngIf="col.isBadge; else nobadge">
                                    <p-tag [ngClass]="getBtnSeverity(rowData[col.field])"
                                        [value]="rowData[col.field]"></p-tag>
                                        
                                </div>
                                <!-- <ng-template #nobadge>
                                    {{rowData[col.field]}}
                                </ng-template> -->

                                <ng-template #nobadge>

  <!-- ✅ Eye icon button for RTSP -->
  <ng-container *ngIf="col.isIconButton; else normalText">

    <button
      pButton
      type="button"
      class="p-button-text p-button-sm"
      [icon]="col.buttonIcon"
      title="View Live Stream"
      (click)="onIconAction(col.actionType, rowData)">
    </button>

  </ng-container>

  <!-- ✅ Normal text for other columns -->
  <ng-template #normalText>
    {{ rowData[col.field] }}
  </ng-template>

</ng-template>

                            </ng-template>
                        </ng-template>
                    </ng-template>
                </td>
            </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
            <tr>
                <td [attr.colspan]="cols.length+1">No Records Found.</td>
            </tr>
        </ng-template>
    </p-table>
    <p-paginator (onPageChange)="onPageChange($event)" [showCurrentPageReport]="true" [first]="first" [rows]="rows"
        [totalRecords]="total" [rowsPerPageOptions]="rowsPerPageOptions"
        currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"></p-paginator>

    <p-confirmPopup key="confirm2"></p-confirmPopup>
</div>