"use strict";(self.webpackChunkUI_Base=self.webpackChunkUI_Base||[]).push([[494],{45494:(Pt,P,p)=>{p.r(P),p.d(P,{ManageWorkModule:()=>qt});var g=p(96814),f=p(18068),A=p(97582),h=p(31290),m=p(78791),e=p(65879),l=p(84221);const O=(0,l.PH)("[MBook] Get MBook List",(0,l.Ky)()),J=(0,l.PH)("[MBook] Get MBook List Success",(0,l.Ky)()),x=(0,l.PH)("[MBook] Get MBook by Id",(0,l.Ky)()),L=(0,l.PH)("[MBook] Get MBook by Id Success",(0,l.Ky)()),V=(0,l.PH)("[MBook]  Save MBook ",(0,l.Ky)()),Q=(0,l.PH)("[MBook] Save MBook Success",(0,l.Ky)()),W=(0,l.PH)("[MBook] Save MBook Status"),Y=(0,l.PH)("[MBook] Get division List"),E=(0,l.PH)("[MBook] Get division List Success",(0,l.Ky)()),H=(0,l.PH)("[MBook] Get Approval Type",(0,l.Ky)()),R=(0,l.PH)("[MBook] Get Approval Type Success",(0,l.Ky)()),G=(0,l.PH)("[MBook] Get File Types"),j=(0,l.PH)("[MBook] Get File Types Success",(0,l.Ky)()),z=(0,l.PH)("[MBook]  approve MBook ",(0,l.Ky)()),$=(0,l.PH)("[MBook] approve MBook Success",(0,l.Ky)()),K=(0,l.PH)("[MBook] SAve approve MBook Status"),X=(0,l.PH)("[MBook] Reset"),ee="MBookState",ye=(0,l.Lq)({mbooks:[],mbook:null,totalRecordCount:0,saveStatus:null,Divisions:[],approvaltypes:[],filetypes:[],approvestatus:null},(0,l.on)(J,(i,{mbooks:o})=>({...i,mbooks:o.data,totalRecordCount:o.totalRecordCount})),(0,l.on)(Q,(i,{mbook:o})=>({...i,saveStatus:{Status:o.status,message:o.message}})),(0,l.on)(L,(i,{mbook:o})=>({...i,mbook:o})),(0,l.on)(W,i=>({...i,saveStatus:null})),(0,l.on)(E,(i,{divisions:o})=>({...i,Divisions:o})),(0,l.on)(R,(i,{approvaltypes:o})=>({...i,approvaltypes:o})),(0,l.on)(j,(i,{filetypes:o})=>({...i,filetypes:o})),(0,l.on)($,(i,{mbook:o})=>({...i,approvestatus:{Status:o.status,message:o.message}})),(0,l.on)(K,(i,{})=>({...i,approvestatus:null})),(0,l.on)(X,(i,{})=>({...i,mbooks:[],mbook:null,totalRecordCount:0,saveStatus:null,Divisions:[],approvaltypes:[],filetypes:[],approvestatus:null}))),b=(0,l.ZF)(ee),we=(0,l.P1)(b,i=>({mbooks:i.mbooks,totalRecords:i.totalRecordCount})),Te=(0,l.P1)(b,i=>i.mbook),Ce=(0,l.P1)(b,i=>i.saveStatus),Ze=(0,l.P1)(b,i=>i.Divisions),Me=(0,l.P1)(b,i=>i.filetypes),Be=(0,l.P1)(b,i=>i.approvaltypes),xe=(0,l.P1)(b,i=>i.approvestatus);let S=(()=>{var i;class o{constructor(n){this.store=n,this.selectMBooks$=this.store.select(we),this.selectSaveStatus$=this.store.select(Ce),this.selectDivisions$=this.store.select(Ze),this.selectMBookbyId$=this.store.select(Te),this.selectfiletypes$=this.store.select(Me),this.selectapprovaltypes$=this.store.select(Be),this.selectapprovestatus$=this.store.select(xe)}getMBooks(n){this.store.dispatch(O({mbookFiletr:n}))}getmbookbyId(n){this.store.dispatch(x({id:n}))}getapprovalTypes(n){this.store.dispatch(x({id:n}))}getfileTypes(n){this.store.dispatch(x({id:n}))}updatesaveStatus(){this.store.dispatch(W())}saveMBook(n){this.store.dispatch(V({mbook:n}))}divisionListGet(){this.store.dispatch(Y())}getApprovalTypes(n){this.store.dispatch(H({mbookId:n}))}getFileTypes(){this.store.dispatch(G())}updateApproveStatus(){this.store.dispatch(K())}ApproveMBook(n){this.store.dispatch(z({mbook:n}))}reset(){this.store.dispatch(X())}}return(i=o).\u0275fac=function(n){return new(n||i)(e.LFG(l.yh))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),o})();var T,v=p(85219),r=p(56223),Se=p(34055),Ne=p(87584);function Fe(i,o){if(1&i&&(e.TgZ(0,"div",9)(1,"span",10),e._uU(2),e.qZA()()),2&i){const t=o.$implicit;e.xp6(2),e.Oqu(t.text)}}function Ae(i,o){if(1&i&&(e.TgZ(0,"div",9)(1,"span",10),e._uU(2),e.qZA()()),2&i){const t=o.$implicit;e.xp6(2),e.Oqu(t)}}const te=function(){return{width:"100%",margin:"0px 20px"}};let N=((T=class{constructor(o,t,n,s,a){this.mbookFacade=o,this.messageService=t,this.router=n,this.route=s,this.titlecasePipe=a,this.currentStatus=!1,this.actions=[],this.title="M-Book",this.first=0,this.rows=25,this.total=0,this.defaultSortField="tenderNumber",this.defaultSortOrder=1,this.selecteddivisions=[],this.selectedYear=[(new Date).getFullYear().toString()],this.yearList=(0,h.S4)(),this.isdiffnav=!1}ngOnInit(){this.filtermodel={divisionIds:null,searchString:null,selectionType:null,skip:0,sorting:{fieldName:"tenderNumber",sort:"ASC"},take:25,where:{isActive:!0},year:[this.selectedYear.toString()],isForApproval:!1,columnSearch:null},this.route.params.pipe((0,m.t)(this)).subscribe(o=>{const t=o.type;t&&("history"===t&&(this.title="M-Book History",this.isdiffnav=!0,this.filtermodel={...this.filtermodel,where:{isActive:!1}}),"approvals"===t&&(this.title="M-Book Approvals",this.isdiffnav=!0,this.filtermodel={...this.filtermodel,isForApproval:!0,where:{isActive:!0}})),this.mbookFacade.getMBooks(this.filtermodel)}),this.mbookFacade.divisionListGet(),this.cols=[{field:"percentageCompleted",header:"Progress",sortablefield:"percentageCompleted",isSortable:!0,isSearchable:!0,isProgress:!0},{field:"paymentPercentage",header:"Payment Percentage",sortablefield:"paymentPercentage",isSortable:!0,isProgress:!0},{field:"mBookNumber",header:"M-Book Number",customExportHeader:"M-Book Number",sortablefield:"mBookNumber",isSortable:!0,isSearchable:!0},{field:"tenderNumber",header:"Work Number",customExportHeader:"Work Number",sortablefield:"tenderNumber",isSortable:!0,isSearchable:!0},{field:"paymentStatusName",header:"Payment Status",sortablefield:"paymentStatusName",isSortable:!0,isSearchable:!0,isBadge:!0},{field:"statusName",header:"Status",sortablefield:"statusName",isSortable:!0,isSearchable:!0,isBadge:!0},{field:"workType",header:"Work Type",sortablefield:"workType",isSortable:!0,isSearchable:!0},{field:"subWorkType",header:"Sub Work Type",sortablefield:"subWorkType",isSortable:!0,isSearchable:!0},{field:"strength",header:"Strength",isSearchable:!0,sortablefield:"strength",isSortable:!0},{field:"milestoneCode",header:"Code",isSearchable:!0,sortablefield:"milestoneCode",isSortable:!0},{field:"milestoneName",header:"Milestone Name",sortablefield:"milestoneName"},{field:"divisionName",header:"Division",sortablefield:"divisionName",isSearchable:!0},{field:"districtName",header:"District",sortablefield:"districtName",isSortable:!0,isSearchable:!0},{field:"goNumber",header:"GO",sortablefield:"goNumber",isSortable:!0,isSearchable:!0},{field:"startDateString",header:"Work Published date",sortablefield:"startDate",isSortable:!0,isSearchable:!0},{field:"endDateString",header:"Awarded Date",sortablefield:"endDate"},{field:"pannedValue",header:"Planned Value",sortablefield:"pannedValue",isSearchable:!0},{field:"actualValue",header:"Actual Value",sortablefield:"actualValue",isSearchable:!0},{field:"paymentValue",header:"Payment Value",sortablefield:"paymentValue",isSearchable:!0},{field:"lastUpdatedDateString",header:"Last Updated Date",sortablefield:"lastUpdatedDate",isSortable:!0}],this.searchableColumns=this.cols.filter(o=>1==o.isSearchable).flatMap(o=>o.field),this.actions=[{icon:"pi pi-pencil",title:"Edit M-Book",type:"EDIT",privilege:h.UR.MBOOK_EDIT,visibilityCheckFeild:"isEditable",isIcon:!0},{icon:"pi pi-arrow-right",title:"Approve",privilege:h.UR.MBOOK_APPROVE_REJECT,type:"APPROVE",visibilityCheckFeild:"isActionable",isIcon:!0},{icon:"pi pi-eye",privilege:h.UR.MBOOK_VIEW,title:"View",type:"VIEW",isIcon:!0}],this.mbookFacade.selectDivisions$.pipe((0,m.t)(this)).subscribe(o=>{o&&(this.divisions=o)}),this.mbookFacade.selectMBooks$.pipe((0,m.t)(this)).subscribe(o=>{o&&(this.configurationList=[],o.mbooks?.forEach(t=>{this.configurationList.push({...t,startDateString:this.dc(t.startDate),endDateString:this.dc(t.endDate),lastUpdatedDateString:this.dcwt(t.lastUpdatedDate)})}),this.total=o.totalRecords)})}changeyear(o){this.filtermodel={...this.filtermodel,year:o},this.mbookFacade.getMBooks(this.filtermodel)}divisionChanged(o){this.filtermodel={...this.filtermodel,divisionIds:o},this.mbookFacade.getMBooks(this.filtermodel)}changefilter(o){this.filtermodel={...this.filtermodel,...o},this.mbookFacade.getMBooks(this.filtermodel)}actioInvoked(o){o&&"EDIT"==o.type?this.isdiffnav?this.router.navigate(["m-book-manage/edit",o.record.id]):this.router.navigate(["edit",o.record.id],{relativeTo:this.route}):o&&"APPROVE"==o.type?this.isdiffnav?this.router.navigate(["m-book-manage/view",o.record.id,!0]):this.router.navigate(["view",o.record.id,!0],{relativeTo:this.route}):o&&"VIEW"==o.type&&(this.isdiffnav?this.router.navigate(["m-book-manage/view",o.record.id]):this.router.navigate(["view",o.record.id],{relativeTo:this.route}))}changeStatus(o){this.mbookFacade.getMBooks(this.filtermodel),this.currentStatus=!o}ngOnDestroy(){this.mbookFacade.reset()}dc(o){return(0,h.ql)(o)}dcwt(o){return(0,h.gv)(o)}}).\u0275fac=function(o){return new(o||T)(e.Y36(S),e.Y36(v.ez),e.Y36(f.F0),e.Y36(f.gz),e.Y36(g.rS))},T.\u0275cmp=e.Xpm({type:T,selectors:[["app-manage-work"]],features:[e._Bn([g.rS])],decls:12,vars:19,consts:[[1,"card"],[1,"grid","formgrid",2,"justify-content","space-between","padding","0rem 1rem","margin-bottom","10px"],[1,"col-12","md:col-6","lg:col-7"],[1,"col-12","md:col-3","lg:col-3"],["placeholder","Select a Division","optionLabel","text","optionValue","value","ngClass","dd",1,"multiselect-custom",3,"options","ngModel","ngStyle","ngModelChange"],["pTemplate","item"],[1,"col-12","md:col-3","lg:col-2"],["placeholder","Select a Year","ngClass","dd",1,"multiselect-custom",3,"options","ngModel","ngStyle","ngModelChange"],[3,"records","cols","fileName","rows","total","actions","defaultSortField","defaultstatus","hasActiveInactive","filterModel","invokeAction","changeStatus","changefilter"],[1,"flex","align-items-center"],[1,"ml-2"]],template:function(o,t){1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4"),e._uU(4),e.qZA()(),e.TgZ(5,"div",3)(6,"p-multiSelect",4),e.NdJ("ngModelChange",function(s){return t.selecteddivisions=s})("ngModelChange",function(s){return t.divisionChanged(s)}),e.YNc(7,Fe,3,1,"ng-template",5),e.qZA()(),e.TgZ(8,"div",6)(9,"p-multiSelect",7),e.NdJ("ngModelChange",function(s){return t.selectedYear=s})("ngModelChange",function(s){return t.changeyear(s)}),e.YNc(10,Ae,3,1,"ng-template",5),e.qZA()()(),e.TgZ(11,"app-datatable-pagination",8),e.NdJ("invokeAction",function(s){return t.actioInvoked(s)})("changeStatus",function(s){return t.changeStatus(s)})("changefilter",function(s){return t.changefilter(s)}),e.qZA()()),2&o&&(e.xp6(4),e.Oqu(t.title),e.xp6(2),e.Q6J("options",t.divisions)("ngModel",t.selecteddivisions)("ngStyle",e.DdM(17,te)),e.xp6(3),e.Q6J("options",t.yearList)("ngModel",t.selectedYear)("ngStyle",e.DdM(18,te)),e.xp6(2),e.Q6J("records",t.configurationList)("cols",t.cols)("fileName","M_Book")("rows",10)("total",t.total)("actions",t.actions)("defaultSortField",t.defaultSortField)("defaultstatus",!t.currentStatus)("hasActiveInactive",!1)("filterModel",t.tableFilterModel))},dependencies:[g.mk,g.PC,r.JJ,r.On,v.jx,Se.NU,Ne.b],styles:[".dd>.p-multiselect{width:100%}  .dd>.p-dropdown{width:100%}"]}),T);N=(0,A.gn)([(0,m.c)()],N);var C,oe=p(93838),De=p(20553),M=p(85571),ie=p(16676),ne=p(99907),se=p(80290),re=p(69862),ae=p(6593),le=p(23212),B=p(40707),pe=p(53714),ce=p(53965),de=p(96218),ue=p(27561),me=p(31494),ge=p(27213),he=p(63722),fe=p(33259);function Ue(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td")(10,"button",41),e.NdJ("click",function(){const a=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.downloadMilestoneFiles(a.id,a.originalFileName))}),e.qZA()(),e.TgZ(11,"td")(12,"button",42),e.NdJ("click",function(){const a=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.showFileInPopup(a.id,a.originalFileName))}),e.qZA()()()}if(2&i){const t=o.$implicit,n=o.index,s=e.oxw();e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t.originalFileName),e.xp6(2),e.Oqu(t.createdByUserName),e.xp6(2),e.Oqu(s.dcwt(t.createdDate))}}function qe(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",43)(1,"span",44),e._uU(2,"Milestone Files"),e.qZA(),e.TgZ(3,"div",45)(4,"button",46),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.downloadMilestoneFiles(s.currentFileId,s.currentFileName))}),e.qZA()()()}}function Ie(i,o){if(1&i&&(e.ynx(0),e._UZ(1,"iframe",47),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("src",t.pdfSrc,e.uOi)}}function Pe(i,o){if(1&i&&(e.ynx(0),e._UZ(1,"img",48),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("src",t.imgSrc,e.LSH)}}function Oe(i,o){if(1&i&&(e.ynx(0),e._UZ(1,"video",49),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("src",t.videoSrc,e.LSH)}}function Je(i,o){if(1&i&&(e.TgZ(0,"span",50),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.validreqDocErrorMsg)}}function Le(i,o){if(1&i&&(e.TgZ(0,"span",50),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.typeErrorMsg)}}function Ve(i,o){if(1&i&&(e.TgZ(0,"span",50),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.typeNameErrorMsg)}}const Qe=function(){return{width:"100%"}};function We(i,o){if(1&i&&(e.TgZ(0,"div"),e._UZ(1,"p-dropdown",60),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Akn(e.DdM(4,Qe)),e.Q6J("options",t.QualityTestingFileTypes)("ngModel",t.QualityTestingFileTypes[0].value)}}function Ye(i,o){1&i&&e._UZ(0,"input",61),2&i&&e.Q6J("maxlength",250)}const Ee=function(){return{width:"65%"}};function He(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"p-fileUpload",62),e.NdJ("uploadHandler",function(s){e.CHM(t);const a=e.oxw().index,c=e.oxw();return e.KtG(c.onSend(s,a))}),e.qZA()}if(2&i){const t=e.oxw().index,n=e.oxw();e.Q6J("ngStyle",e.DdM(6,Ee))("customUpload",!0)("files",n.Otherfiles)("auto",!0)("disabled",!n.fileListd[t].controls.type.value&&!n.fileListd[t].controls.typeName.value)("maxFileSize",2e6)}}function Re(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",63),e.NdJ("click",function(){e.CHM(t);const s=e.oxw().index,a=e.oxw();return e.KtG(a.showDocPdf(a.fileListd[s].controls.id.value,a.fileListd[s].controls.originalFileName.value))}),e.qZA()}}function Ge(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"button",64),e.NdJ("click",function(){e.CHM(t);const s=e.oxw().index,a=e.oxw();return e.KtG(a.download(a.fileListd[s].controls.id.value,a.fileListd[s].controls.originalFileName.value))}),e.qZA()}}const je=function(){return{width:"100%"}};function ze(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"tr",51)(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td")(4,"p-dropdown",52),e.NdJ("onChange",function(s){const c=e.CHM(t).index,d=e.oxw();return e.KtG(d.changeRole(s,c))}),e.qZA()(),e.TgZ(5,"td"),e.YNc(6,We,2,5,"div",53),e.YNc(7,Ye,1,1,"ng-template",null,54,e.W1O),e.qZA(),e.TgZ(9,"td"),e._uU(10),e.qZA(),e.TgZ(11,"td",55),e.YNc(12,He,1,7,"p-fileUpload",56),e.YNc(13,Re,1,0,"button",57),e.YNc(14,Ge,1,0,"button",58),e.TgZ(15,"button",59),e.NdJ("click",function(){const a=e.CHM(t).index,c=e.oxw();return e.KtG(c.removefiledetails(a))}),e.qZA()()()}if(2&i){const t=o.$implicit,n=o.index,s=e.MAs(8),a=e.oxw();let c;e.Q6J("formGroupName",n),e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Akn(e.DdM(12,je)),e.Q6J("options",a.filetypes)("showClear",!1),e.xp6(2),e.Q6J("ngIf","MBookTestingDocument"===(null==(c=t.get("type"))?null:c.value))("ngIfElse",s),e.xp6(4),e.hij(" ",a.fileListd[n].controls.originalFileName.value,""),e.xp6(2),e.Q6J("ngIf",!a.fileListd[n].controls.originalFileName.value),e.xp6(1),e.Q6J("ngIf",a.fileListd[n].controls.originalFileName.value),e.xp6(1),e.Q6J("ngIf",a.fileListd[n].controls.originalFileName.value)}}function $e(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",43)(1,"span",44),e._uU(2,"Mbook Files"),e.qZA(),e.TgZ(3,"div",45)(4,"button",46),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.download(s.currentFileId,s.currentFileName))}),e.qZA()()()}}function Ke(i,o){if(1&i&&(e.ynx(0),e._UZ(1,"iframe",65),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("src",t.pdfSrc,e.uOi)}}function Xe(i,o){if(1&i&&(e.ynx(0),e._UZ(1,"img",66),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("src",t.imgSrc,e.LSH)}}function et(i,o){if(1&i&&(e.ynx(0),e._UZ(1,"video",67),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("src",t.videoSrc,e.LSH)}}function tt(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",68)(1,"button",69),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.submit(!1))}),e.qZA(),e._UZ(2,"button",70),e.TgZ(3,"button",71),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.resetForm())}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("disabled",!t.mBookForm.valid||t.validreqDocErrorMsg),e.xp6(1),e.Q6J("disabled",(!t.mBookForm.valid||t.validreqDocErrorMsg)&&t.canSubmit)}}function ot(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",68)(1,"button",72),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.submit(!1))}),e.qZA(),e.TgZ(2,"button",71),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.resetForm())}),e.qZA()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("disabled",!t.mBookForm.valid||t.validreqDocErrorMsg)}}const ve=function(){return{width:"95vw",height:"90vh"}},it=function(){return{"margin-right":"20px;"}};let D=((C=class{get f(){return this.mBookForm.controls}get t(){return this.f.documents}get fileListd(){return this.t.controls}get typeErrorMsg(){var o;return this.fileListd.map(t=>{t.controls.type.errors&&(o=t.controls.type.errors)}),o&&o.required?"Required":null}get validreqDocErrorMsg(){var n=[];return this.fileListd.map(s=>{s.controls.id.value&&(n=[...n,s.controls.type.value])}),["MBookEntryDocument","MBookTestingDocument","MBookPhotos","MBookVideos"].every(s=>n.includes(s))?null:"Please provide  mandatory documents to submit the MBook"}get typeNameErrorMsg(){var o;return this.fileListd.map(t=>{t.controls.typeName.errors&&(o=t.controls.typeName.errors)}),o&&o.required?"Required":null}constructor(o,t,n,s,a,c,d,U,q,I){this.mbookFacade=o,this.messageService=t,this.confirmationService=n,this.router=s,this.route=a,this.generalService=c,this.tenderService=d,this.formBuilder=U,this.http=q,this.sanitizer=I,this.title="M-Book Edit",this.Savelabel="Save",this.Otherfiles=[],this.showViewer=!1,this.fileType=null,this.isSubmitted=!1,this.canSubmit=!1,this.filesList=[],this.QualityTestingFileTypes=[{text:"Quality Testing Documents",value:"Quality Testing Documents"},{text:"Chemical & Physical Properties of Lime",value:"Chemical & Physical Properties of Lime"},{text:"Bulking of Sand",value:"Bulking of Sand"},{text:"Silt Content",value:"Silt Content"},{text:"Particle size distribution",value:"Particle size distribution"}]}ngOnInit(){this.mbookFacade.getFileTypes(),this.route.params.pipe((0,m.t)(this)).subscribe(o=>{this.mBookId=o.id}),this.mbookFacade.selectMBookbyId$.pipe((0,m.t)(this)).subscribe(o=>{o&&(this.mBookDetails=o,this.canSubmit=0==o.isActionable&&1==o.isEditable,this.mBookDetails?(this.getMilestoneFiles(this.mBookDetails.workTemplateMilestoneId),this.setvaluesofortheForm(),this.mBookDetails.files&&this.mBookDetails.files.length>0?(this.generateDefaultRows(this.mBookDetails.files),this.filetypes.forEach(t=>{this.mBookDetails?.files?.find(n=>n.type==t.value)||this.createDummyrows(t.value,t.text)})):this.filetypes.forEach(t=>{this.createDummyrows(t.value,t.text)})):this.filetypes.forEach(t=>{this.createDummyrows(t.value,t.text)}),this.disablecontroles())}),this.mbookFacade.selectfiletypes$.pipe((0,m.t)(this)).subscribe(o=>{o&&(this.filetypes=o,this.mBookId&&this.mbookFacade.getmbookbyId(this.mBookId))}),this.mbookFacade.selectSaveStatus$.pipe((0,m.t)(this)).subscribe(o=>{!o||o.Status!=M.cH&&o.Status!=M.nQ?o&&(this.messageService.add({severity:"success",summary:"Success",detail:o?.message}),this.isSubmitted&&this.router.navigate(["m-book-manage"])):this.messageService.add({severity:"error",summary:"Error",life:8e4,detail:o.message})}),this.mBookForm=new r.cw({id:new r.NI(this.mBookId),isSubmitted:new r.NI(!1),actuals:new r.NI(0,[r.kI.required]),date:new r.NI("",[r.kI.required]),notes:new r.NI("",[r.kI.required]),documents:new r.Oe([])}),this.approvalForm=new r.cw({id:new r.NI(oe.i.raw()),date:new r.NI("",[r.kI.maxLength(200)]),notes:new r.NI("",[r.kI.required]),type:new r.NI("",[r.kI.required])})}createDummyrows(o,t){this.t.push(this.formBuilder.group({id:[null],type:[o,[r.kI.required]],typeName:[t,[r.kI.required]],originalFileName:[null],savedFileName:[null],fileType:[null],typeId:[this.mBookId,[r.kI.required]]}))}generateDefaultRows(o){this.t.clear(),o&&o.forEach(t=>{this.t.push(this.formBuilder.group({id:[t.id],type:[t.type,[r.kI.required]],typeName:[t.typeName,[r.kI.required]],originalFileName:[t.originalFileName],savedFileName:[t.savedFileName],fileType:[t.fileType],typeId:[this.mBookId,[r.kI.required]]}))})}addnewRow(o){this.confirmationService.confirm({key:"confirm2",target:o.target||new EventTarget,message:"Are you sure that you want to Add?",icon:"pi pi-exclamation-triangle",accept:()=>{this.t.push(this.formBuilder.group({id:[null],type:[null,[r.kI.required]],typeName:[null,[r.kI.required]],originalFileName:[null],savedFileName:[null],fileType:[null],typeId:[this.mBookId,[r.kI.required]]}))},reject:()=>{}})}submit(o=!0){this.mbookFacade.updatesaveStatus(),this.mbookFacade.saveMBook({date:this.mBookForm.get("date")?.value,actualAmount:this.mBookForm.get("actuals")?.value,id:this.mBookForm.get("id")?.value,workNotes:this.mBookForm.get("notes")?.value,isSubmitted:o,statusCode:this.canSubmit?"":"ONLYSAVE"}),this.isSubmitted=o}disablecontroles(){this.fileListd.map(o=>{o.controls.type.value&&o.controls.id.value?(o.controls.type.disable({onlySelf:!0}),o.controls.typeName.disable({onlySelf:!0})):o.controls.type.value&&!o.controls.id.value&&"MBookOtherDoc"!==o.controls.type.value&&"MBookTestingDocument"!==o.controls.type.value?o.controls.typeName.disable({onlySelf:!0}):(o.controls.type.enable({onlySelf:!0}),o.controls.typeName.enable({onlySelf:!0}))})}setvaluesofortheForm(){this.mBookForm.get("date")?.patchValue(this.mBookDetails?.date?ie(this.mBookDetails?.date).toDate():null),this.mBookForm.get("notes")?.patchValue(this.mBookDetails?.workNotes),this.mBookForm.get("actuals")?.patchValue(this.mBookDetails?.actualAmount)}changeRole(o,t){const n=this.filetypes.find(s=>s.value==o.value);this.fileListd[t].controls.typeName.patchValue(n?.text),"MBookOtherDoc"!==n?.value?this.fileListd[t].controls.typeName.disable({onlySelf:!0}):this.fileListd[t].controls.typeName.enable({onlySelf:!0}),"MBookTestingDocument"!==n?.value?this.fileListd[t].controls.typeName.disable({onlySelf:!0}):this.fileListd[t].controls.typeName.enable({onlySelf:!0})}testDoc(o,t){const n=this.filetypes.find(s=>s.value==o.value);this.fileListd[t].controls.typeName.patchValue(n?.text),"MBookTestingDocument"!==n?.value?this.fileListd[t].controls.typeName.disable({onlySelf:!0}):this.fileListd[t].controls.typeName.enable({onlySelf:!0})}resetForm(){this.mbookFacade.updatesaveStatus(),this.router.navigate(["m-book-manage"])}back(){this.mbookFacade.updatesaveStatus(),this.router.navigate(["m-book-manage"])}onSend(o,t){if(o.files&&o.files.length>0){const n=new FormData;n.append("File",o.files[0]),n.append("Type",this.fileListd[t].controls.type.value),n.append("TypeId",this.mBookId),n.append("typeName",this.fileListd[t].controls.typeName.value),this.http.post(`${De.N.apiUrl}/Common/UploadFile`,n).subscribe(s=>{this.Otherfiles=[],this.fileListd[t].controls.id.patchValue(s.data.id),this.fileListd[t].controls.originalFileName.patchValue(s.data.originalFileName),this.fileListd[t].controls.savedFileName.patchValue(s.data.savedFileName),this.fileListd[t].controls.fileType.patchValue(s.data.fileType),this.fileListd[t].controls.typeName.patchValue(s.data.typeName),this.fileListd[t].controls.type.disable({onlySelf:!0}),this.fileListd[t].controls.typeName.disable({onlySelf:!0}),this.messageService.add({severity:"success",summary:"Success",detail:"Uploaded Successfully"})},s=>{this.messageService.add({severity:"error",summary:"Error",detail:"Failed to Upload! Please try again"})})}}download(o,t){this.currentFileId=o,this.currentFileName=t,this.generalService.downloads(o,t)}showDocPdf(o,t){this.currentFileId=o,this.currentFileName=t,this.generalService.ViewPdf(o).subscribe(n=>{const s=URL.createObjectURL(n),a=t.split(".").pop()?.toLowerCase();if(["pdf","doc","docx","xlsx","xls","clsx","ppt","pptx","txt"].includes(a))this.fileType="pdf",this.pdfSrc=this.sanitizer.bypassSecurityTrustResourceUrl(s);else if(["png","jpg","jpeg","gif","bmp","webp"].includes(a))this.fileType="image",this.imgSrc=this.sanitizer.bypassSecurityTrustResourceUrl(s);else{if(!["mp4","webm","ogg"].includes(a))return void console.warn("Unsupported file type:",a);this.fileType="video",this.videoSrc=this.sanitizer.bypassSecurityTrustResourceUrl(s)}this.showViewer=!0})}removefiledetails(o){this.fileListd[o].controls.id.value?this.tenderService.filemasterSaveUpdate({...this.fileListd[o].value,isActive:!1}).subscribe(t=>{t.status==M.BA&&this.t.removeAt(o)}):this.t.removeAt(o)}savefiledetails(o){}ngOnDestroy(){this.mbookFacade.reset()}dc(o){return(0,h.ql)(o)}dcwt(o){return(0,h.gv)(o)}getMilestoneFiles(o){this.tenderService.MilestoneFiles(o).subscribe(t=>{t&&(this.filesList=t.data)})}showFileInPopup(o,t){this.currentFileId=o,this.currentFileName=t,this.generalService.ViewPdf(o).subscribe(n=>{const s=URL.createObjectURL(n),a=t.split(".").pop()?.toLowerCase();if(["pdf","doc","docx","clsx","xlsx","xls","ppt","pptx","txt"].includes(a))this.fileType="pdf",this.pdfSrc=this.sanitizer.bypassSecurityTrustResourceUrl(s);else if(["png","jpg","jpeg","gif","bmp","webp"].includes(a))this.fileType="image",this.imgSrc=this.sanitizer.bypassSecurityTrustResourceUrl(s);else{if(!["mp4","webm","ogg"].includes(a))return void console.warn("Unsupported file type:",a);this.fileType="video",this.videoSrc=this.sanitizer.bypassSecurityTrustResourceUrl(s)}this.showViewer=!0})}downloadMilestoneFiles(o,t){this.generalService.downloads(o,t??"File.png")}DeleteMilestoneFile(o,t){this.tenderService.DeleteMilestoneFile(o,t).subscribe(n=>{n&&n.data&&this.getMilestoneFiles(o)})}convertoWordsIND(o){return(0,h.i7)(o)}}).\u0275fac=function(o){return new(o||C)(e.Y36(S),e.Y36(v.ez),e.Y36(v.YP),e.Y36(f.F0),e.Y36(f.gz),e.Y36(ne.m),e.Y36(se.$),e.Y36(r.qu),e.Y36(re.eN),e.Y36(ae.H7))},C.\u0275cmp=e.Xpm({type:C,selectors:[["app-create-work"]],features:[e._Bn([g.rS])],decls:146,vars:49,consts:[[1,"card"],[1,"grid","formgrid",2,"justify-content","space-between","padding","0rem 1rem","margin-bottom","10px"],[1,""],["icon","pi pi-arrow-left",3,"onClick"],[1,"card","p-fluid",2,"padding","20px 20px 20px 20px","background-color","#e6e7ff"],[1,"p-formgrid","grid"],[1,"col-11"],[1,"col-12","row"],[1,"lg:col-4","md:col-4","sm:col-12","boldlabelinsiderow"],[1,"col-12",2,"padding","20px","margin-bottom","10px","margin-top","10px","text-align","left"],[1,"table","sssdt"],[4,"ngFor","ngForOf"],["styleClass","milestone-popup",3,"visible","modal","dismissableMask","visibleChange"],["pTemplate","header"],[1,"viewer-container"],[4,"ngIf"],[3,"formGroup","ngSubmit"],[1,"p-fluid"],[1,"flex","grid","formgrid"],[1,"field","sm:col-12","md:col-6","lg:col-6"],["htmlFor","category"],["formControlName","date","inputId","icon",3,"showIcon","readonlyInput"],[3,"control"],["pInputText","","formControlName","actuals","type","text",3,"maxlength"],[1,"field","col-12"],["rows","2","pInputTextarea","","formControlName","notes"],[1,"row","flex",2,"justify-content","space-between"],[1,"col"],[1,"col",2,"text-align","end"],["type","button","icon","pi pi-plus",3,"ngStyle","onClick"],["class","tableheadererrormsg",4,"ngIf"],["key","confirm2"],[1,"formgrid","mb-3",2,"margin-bottom","40px !important"],[1,"card","p-fluid",2,"padding-bottom","10px"],[3,"disabled"],[1,"table"],[2,"min-width","300px"],["formArrayName","documents"],[3,"formGroupName",4,"ngFor","ngForOf"],["class","col-12  flex ","style","margin-top: 25px;justify-content: end;flex-wrap: wrap;",4,"ngIf","ngIfElse"],["buttn",""],["type","button","pButton","","pRipple","","icon","pi pi-arrow-down","pTooltip","Download","title","Download File","styleClass","p-button-text",1,"p-button-text","mr-2",3,"click"],["type","button","pButton","","pRipple","","icon","pi pi-eye","pTooltip","View","title","View File",1,"p-button-text",3,"click"],[1,"header-container"],[1,"header-title","center"],[1,"header-actions"],["type","button","pButton","","icon","pi pi-arrow-down","pTooltip","Download",1,"icon-download-btn",3,"click"],["frameborder","0",1,"viewer-full",3,"src"],["alt","Preview",1,"viewer-full",3,"src"],["controls","",1,"viewer-full",3,"src"],[1,"tableheadererrormsg"],[3,"formGroupName"],["optionLabel","text","optionValue","value","placeholder","Select a Type","formControlName","type",3,"options","showClear","onChange"],[4,"ngIf","ngIfElse"],["normalInput",""],[2,"display","flex"],["mode","basic","chooseLabel","Add","accept","image/*, .doc,.docx,.xml,application/msword, .pdf, .xls, .xlsx, video/* ",3,"ngStyle","customUpload","files","auto","disabled","maxFileSize","uploadHandler",4,"ngIf"],["pButton","","pRipple","","type","button","icon","pi pi-eye","pTooltip","View","class","p-button-success  ml-2","title","View File",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","icon","pi pi-arrow-down","pTooltip","View","class","p-button-success  ml-2","title","View File",3,"click",4,"ngIf"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-text","ml-2",3,"click"],["optionLabel","text","optionValue","value","placeholder","Select Sub Type","formControlName","typeName",3,"options","ngModel"],["pInputText","","formControlName","typeName","type","text",3,"maxlength"],["mode","basic","chooseLabel","Add","accept","image/*, .doc,.docx,.xml,application/msword, .pdf, .xls, .xlsx, video/* ",3,"ngStyle","customUpload","files","auto","disabled","maxFileSize","uploadHandler"],["pButton","","pRipple","","type","button","icon","pi pi-eye","pTooltip","View","title","View File",1,"p-button-success","ml-2",3,"click"],["pButton","","pRipple","","type","button","icon","pi pi-arrow-down","pTooltip","View","title","View File",1,"p-button-success","ml-2",3,"click"],[1,"viewer-content",3,"src"],["alt","Preview",1,"viewer-content",3,"src"],["controls","",1,"viewer-content",3,"src"],[1,"col-12","flex",2,"margin-top","25px","justify-content","end","flex-wrap","wrap"],["pButton","","type","button","label","Save",2,"margin-left","10px",3,"disabled","click"],["pButton","","type","submit","label","Submit",2,"margin-left","10px",3,"disabled"],["pButton","","type","button","label","Cancel",1,"p-button-secondary",2,"margin-left","10px",3,"click"],["pButton","","type","button","label","Update",2,"margin-left","10px",3,"disabled","click"]],template:function(o,t){if(1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4"),e._uU(4),e.qZA()(),e.TgZ(5,"div",2)(6,"p-button",3),e.NdJ("onClick",function(){return t.back()}),e.qZA()()(),e.TgZ(7,"div",4)(8,"div",5)(9,"div",6)(10,"div",7)(11,"div",8)(12,"span"),e._uU(13,"M-Book Number: "),e.qZA(),e._uU(14),e.qZA(),e.TgZ(15,"div",8)(16,"span"),e._uU(17,"Work Number: "),e.qZA(),e._uU(18),e.qZA(),e.TgZ(19,"div",8)(20,"span"),e._uU(21,"Work Type: "),e.qZA(),e._uU(22),e.qZA(),e.TgZ(23,"div",8)(24,"span"),e._uU(25,"Sub Work Type: "),e.qZA(),e._uU(26),e.qZA(),e.TgZ(27,"div",8)(28,"span"),e._uU(29,"Strength: "),e.qZA(),e._uU(30),e.qZA(),e.TgZ(31,"div",8)(32,"span"),e._uU(33,"Code: "),e.qZA(),e._uU(34),e.qZA(),e.TgZ(35,"div",8)(36,"span"),e._uU(37,"Milestone Name: "),e.qZA(),e._uU(38),e.qZA(),e.TgZ(39,"div",8)(40,"span"),e._uU(41,"District: "),e.qZA(),e._uU(42),e.qZA(),e.TgZ(43,"div",8)(44,"span"),e._uU(45,"Division: "),e.qZA(),e._uU(46),e.qZA(),e.TgZ(47,"div",8)(48,"span"),e._uU(49,"Start Date: "),e.qZA(),e._uU(50),e.qZA(),e.TgZ(51,"div",8)(52,"span"),e._uU(53,"End Date: "),e.qZA(),e._uU(54),e.qZA(),e.TgZ(55,"div",8)(56,"span"),e._uU(57,"Planned Value: "),e.qZA(),e._uU(58),e.qZA()()(),e.TgZ(59,"div",9)(60,"h5"),e._uU(61,"Milestone Files"),e.qZA(),e.TgZ(62,"table",10)(63,"thead")(64,"tr")(65,"th"),e._uU(66," S. No"),e.qZA(),e.TgZ(67,"th"),e._uU(68," Name"),e.qZA(),e.TgZ(69,"th"),e._uU(70," Saved by"),e.qZA(),e.TgZ(71,"th"),e._uU(72," Saved date"),e.qZA(),e.TgZ(73,"th"),e._uU(74," Download"),e.qZA(),e.TgZ(75,"th"),e._uU(76," View"),e.qZA()()(),e.TgZ(77,"tbody"),e.YNc(78,Ue,13,4,"tr",11),e.qZA()(),e.TgZ(79,"p-dialog",12),e.NdJ("visibleChange",function(s){return t.showViewer=s}),e.YNc(80,qe,5,0,"ng-template",13),e.TgZ(81,"div",14),e.YNc(82,Ie,2,1,"ng-container",15),e.YNc(83,Pe,2,1,"ng-container",15),e.YNc(84,Oe,2,1,"ng-container",15),e.qZA()()()()(),e.TgZ(85,"form",16),e.NdJ("ngSubmit",function(){return t.submit()}),e.TgZ(86,"div",17)(87,"div",18)(88,"div",19)(89,"label",20),e._uU(90,"Date"),e.qZA(),e._UZ(91,"p-calendar",21)(92,"app-error-msg",22),e.qZA(),e.TgZ(93,"div",19)(94,"label",20),e._uU(95,"Amount spent"),e.qZA(),e._UZ(96,"input",23)(97,"app-error-msg",22),e.qZA(),e.TgZ(98,"div",24)(99,"label",20),e._uU(100,"Notes"),e.qZA(),e._UZ(101,"textarea",25)(102,"app-error-msg",22),e.qZA()()(),e.TgZ(103,"div",26)(104,"div",27)(105,"h5"),e._uU(106,"Files "),e.qZA(),e.TgZ(107,"h6"),e._uU(108,"Please upload all required documents for M-Book submission."),e.qZA(),e._UZ(109,"br"),e.qZA(),e.TgZ(110,"div",28)(111,"p-button",29),e.NdJ("onClick",function(s){return t.addnewRow(s)}),e.qZA()()(),e.YNc(112,Je,2,1,"span",30),e._UZ(113,"p-confirmPopup",31),e.TgZ(114,"div",32)(115,"div",33)(116,"fieldset",34)(117,"div",5)(118,"table",35)(119,"thead")(120,"tr")(121,"th"),e._uU(122,"S.No"),e.qZA(),e.TgZ(123,"th",36),e._uU(124,"File Type "),e._UZ(125,"br"),e.YNc(126,Le,2,1,"span",30),e.qZA(),e.TgZ(127,"th"),e._uU(128,"File Type Name"),e._UZ(129,"br"),e.YNc(130,Ve,2,1,"span",30),e.qZA(),e.TgZ(131,"th"),e._uU(132,"Uploaded File Name"),e.qZA(),e.TgZ(133,"th"),e._uU(134,"Action"),e.qZA()()(),e.TgZ(135,"tbody",37),e.YNc(136,ze,16,13,"tr",38),e.qZA()(),e.TgZ(137,"p-dialog",12),e.NdJ("visibleChange",function(s){return t.showViewer=s}),e.YNc(138,$e,5,0,"ng-template",13),e.TgZ(139,"div",14),e.YNc(140,Ke,2,1,"ng-container",15),e.YNc(141,Xe,2,1,"ng-container",15),e.YNc(142,et,2,1,"ng-container",15),e.qZA()()()()()(),e.YNc(143,tt,4,2,"div",39),e.YNc(144,ot,3,1,"ng-template",null,40,e.W1O),e.qZA()()),2&o){const n=e.MAs(145);e.xp6(4),e.Oqu(t.title),e.xp6(10),e.hij("",t.mBookDetails&&t.mBookDetails.mBookNumber?t.mBookDetails.mBookNumber:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.tenderNumber?t.mBookDetails.tenderNumber:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.workType?t.mBookDetails.workType:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.subWorkType?t.mBookDetails.subWorkType:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.strength?t.mBookDetails.strength:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.milestoneCode?t.mBookDetails.milestoneCode:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.milestoneName?t.mBookDetails.milestoneName:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.districtName?t.mBookDetails.districtName:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.divisionName?t.mBookDetails.divisionName:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.startDate?t.dc(t.mBookDetails.startDate):""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.endDate?t.dc(t.mBookDetails.endDate):""," "),e.xp6(4),e.AsE("",t.mBookDetails&&t.mBookDetails.milestoneAmount?t.mBookDetails.milestoneAmount:"","",t.mBookDetails&&t.mBookDetails.milestoneAmount?" ("+t.convertoWordsIND(t.mBookDetails.milestoneAmount)+")":""," "),e.xp6(20),e.Q6J("ngForOf",t.filesList),e.xp6(1),e.Akn(e.DdM(46,ve)),e.Q6J("visible",t.showViewer)("modal",!0)("dismissableMask",!0),e.xp6(3),e.Q6J("ngIf","pdf"===t.fileType),e.xp6(1),e.Q6J("ngIf","image"===t.fileType),e.xp6(1),e.Q6J("ngIf","video"===t.fileType),e.xp6(1),e.Q6J("formGroup",t.mBookForm),e.xp6(6),e.Q6J("showIcon",!0)("readonlyInput",!0),e.xp6(1),e.Q6J("control",t.mBookForm.get("date")),e.xp6(4),e.Q6J("maxlength",10),e.xp6(1),e.Q6J("control",t.mBookForm.get("actuals")),e.xp6(5),e.Q6J("control",t.mBookForm.get("notes")),e.xp6(9),e.Q6J("ngStyle",e.DdM(47,it)),e.xp6(1),e.Q6J("ngIf",t.validreqDocErrorMsg),e.xp6(4),e.Q6J("disabled",!1),e.xp6(10),e.Q6J("ngIf",t.typeErrorMsg),e.xp6(4),e.Q6J("ngIf",t.typeNameErrorMsg),e.xp6(6),e.Q6J("ngForOf",t.t.controls),e.xp6(1),e.Akn(e.DdM(48,ve)),e.Q6J("visible",t.showViewer)("modal",!0)("dismissableMask",!0),e.xp6(3),e.Q6J("ngIf","pdf"===t.fileType),e.xp6(1),e.Q6J("ngIf","image"===t.fileType),e.xp6(1),e.Q6J("ngIf","video"===t.fileType),e.xp6(1),e.Q6J("ngIf",t.canSubmit)("ngIfElse",n)}},dependencies:[g.sg,g.O5,g.PC,r._Y,r.Fj,r.JJ,r.JL,r.nD,v.jx,le.f,B.Hq,B.zx,pe.o,ce.Lt,de.g,r.sg,r.u,r.x0,r.CE,ue.u,me.P,ge.V,he.p,fe.u],styles:[".hedsr button{margin-right:20px}.tableheadererrormsg[_ngcontent-%COMP%]{font-weight:400;color:#ff0052}.boldlabel[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{font-weight:700}.boldlabelinsiderow[_ngcontent-%COMP%]{padding:10px!important}.boldlabelinsiderow[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}.boldlabelhiegr[_ngcontent-%COMP%]{padding:0!important}.boldlabelhiegr[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:650;font-size:13px}.sssdt[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .sssdt[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#e6e7ff;padding:10px}.stablediv[_ngcontent-%COMP%]{padding:15px;background-color:#e6e7ff;border-radius:10px}.iconstyling[_ngcontent-%COMP%]{padding:10px;border-radius:5px;background-color:#aaf}  .p-card .p-card-content{padding:.25rem 0}  .p-card .p-card-title{font-size:1 rem}  .setheight{min-height:599px;max-height:600px;overflow:auto}  .sddd{min-height:599px;max-height:600px}  .milestone-popup .p-dialog{border-radius:0!important;background-color:#f5f7fa!important;border:2px solid #cfd8dc!important}.header-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}.header-title[_ngcontent-%COMP%]{font-size:22px;font-weight:700;color:#121212}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}  .milestone-popup .p-dialog-header{background-color:#e9ebec!important;padding:.75rem 1rem}.icon-download-btn[_ngcontent-%COMP%]{background-color:transparent!important;border:none!important;width:36px!important;height:36px!important;border-radius:50%!important;padding:0!important;display:flex;align-items:center;justify-content:center;cursor:pointer}.icon-download-btn[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.1rem;color:#070707}.close-btn[_ngcontent-%COMP%]{background:transparent!important;border:none!important;color:#e51717!important}.viewer-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:calc(90vh - 70px)}.viewer-content[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain;border:none}.milestone-popup[_ngcontent-%COMP%]   .p-dialog-content[_ngcontent-%COMP%]{padding:0;height:100%}.viewer-container[_ngcontent-%COMP%]{width:100%;height:100%}.viewer-full[_ngcontent-%COMP%]{width:100%;height:100%;border:none;object-fit:contain}.viewer-container[_ngcontent-%COMP%]{width:100%;height:calc(100vh - 60px)}.viewer-container[_ngcontent-%COMP%]   iframe[_ngcontent-%COMP%], .viewer-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;border:none}.viewer-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%;height:100%;border:none}"]}),C);D=(0,A.gn)([(0,m.c)()],D);var Z,nt=p(26239);function st(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"tr")(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e._uU(4),e.qZA(),e.TgZ(5,"td"),e._uU(6),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.qZA(),e.TgZ(9,"td")(10,"button",37),e.NdJ("click",function(){const a=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.downloadMilestoneFiles(a.id,a.originalFileName))}),e.qZA()(),e.TgZ(11,"td")(12,"button",38),e.NdJ("click",function(){const a=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.showFileInPopup(a.id,a.originalFileName))}),e.qZA()()()}if(2&i){const t=o.$implicit,n=o.index,s=e.oxw();e.xp6(2),e.Oqu(n+1),e.xp6(2),e.Oqu(t.originalFileName),e.xp6(2),e.Oqu(t.createdByUserName),e.xp6(2),e.Oqu(s.dcwt(t.createdDate))}}function rt(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",39)(1,"span",40),e._uU(2,"Milestone Files"),e.qZA(),e.TgZ(3,"div",41)(4,"button",42),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.downloadMilestoneFiles(s.currentFileId,s.currentFileName))}),e.qZA()()()}}function at(i,o){if(1&i&&(e.ynx(0),e._UZ(1,"iframe",43),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("src",t.pdfSrc,e.uOi)}}function lt(i,o){if(1&i&&(e.ynx(0),e._UZ(1,"img",44),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("src",t.imgSrc,e.LSH)}}function pt(i,o){if(1&i&&(e.ynx(0),e._UZ(1,"video",45),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("src",t.videoSrc,e.LSH)}}function ct(i,o){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=e.oxw().index,n=e.oxw();e.xp6(1),e.AsE(" ",n.getQualityFileText(n.fileListd[t].controls.type.value)," - ",n.fileListd[t].controls.typeName.value," ")}}function dt(i,o){if(1&i&&e._uU(0),2&i){const t=e.oxw().index,n=e.oxw();e.hij(" ",n.fileListd[t].controls.typeName.value," ")}}function ut(i,o){if(1&i&&(e.ynx(0),e._uU(1),e.BQk()),2&i){const t=e.oxw().index,n=e.oxw();e.xp6(1),e.hij(" /",n.fileListd[t].controls.savedbyuserdivision.value," ")}}function mt(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"tr",46)(1,"td"),e._uU(2),e.qZA(),e.TgZ(3,"td"),e.YNc(4,ct,2,2,"ng-container",47),e.YNc(5,dt,1,1,"ng-template",null,48,e.W1O),e.qZA(),e.TgZ(7,"td"),e._uU(8),e.YNc(9,ut,2,1,"ng-container",15),e.qZA(),e.TgZ(10,"td"),e._uU(11),e.qZA(),e.TgZ(12,"td"),e._uU(13),e.qZA(),e.TgZ(14,"td",49)(15,"button",50),e.NdJ("click",function(){const a=e.CHM(t).index,c=e.oxw();return e.KtG(c.download(c.fileListd[a].controls.id.value,c.fileListd[a].controls.originalFileName.value))}),e.qZA()(),e.TgZ(16,"td")(17,"button",51),e.NdJ("click",function(){const a=e.CHM(t).index,c=e.oxw();return e.KtG(c.showDocPdf(c.fileListd[a].controls.id.value,c.fileListd[a].controls.originalFileName.value))}),e.qZA()()()}if(2&i){const t=o.index,n=e.MAs(6),s=e.oxw();e.Q6J("formGroupName",t),e.xp6(2),e.Oqu(t+1),e.xp6(2),e.Q6J("ngIf","MBookTestingDocument"===s.fileListd[t].controls.type.value)("ngIfElse",n),e.xp6(4),e.AsE(" ",s.fileListd[t].controls.savedby.value,"/ ",s.fileListd[t].controls.savedbyrole.value," "),e.xp6(1),e.Q6J("ngIf","Hq-executive Engineer"!==s.fileListd[t].controls.savedbyrole.value&&"Hq-assitant Engineer"!==s.fileListd[t].controls.savedbyrole.value&&"Hq-chief Engineer"!==s.fileListd[t].controls.savedbyrole.value&&"Hq-financial Admin"!==s.fileListd[t].controls.savedbyrole.value),e.xp6(2),e.Oqu(s.dcwt(s.fileListd[t].controls.savedDate.value)),e.xp6(2),e.Oqu(s.fileListd[t].controls.originalFileName.value)}}function gt(i,o){1&i&&(e.TgZ(0,"tr")(1,"td",52),e._uU(2,"No Records Found."),e.qZA()()),2&i&&(e.xp6(1),e.Q6J("colSpan",5))}function ht(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"div",39)(1,"span",40),e._uU(2,"MBook Files"),e.qZA(),e.TgZ(3,"div",41)(4,"button",42),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.download(s.currentFileId,s.currentFileName))}),e.qZA()()()}}function ft(i,o){if(1&i&&(e.ynx(0),e._UZ(1,"iframe",43),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("src",t.pdfSrc,e.uOi)}}function vt(i,o){if(1&i&&(e.ynx(0),e._UZ(1,"img",44),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("src",t.imgSrc,e.LSH)}}function bt(i,o){if(1&i&&(e.ynx(0),e._UZ(1,"video",45),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("src",t.videoSrc,e.LSH)}}function _t(i,o){1&i&&(e.TgZ(0,"h5"),e._uU(1,"Approval History "),e.qZA())}function kt(i,o){if(1&i&&(e.TgZ(0,"div",30)(1,"div",31)(2,"div",53),e._UZ(3,"app-view-mbook-history",54),e.qZA()()()),2&i){const t=e.oxw();e.xp6(3),e.Q6J("history",null==t.mBookDetails?null:t.mBookDetails.approvalHistory)}}function yt(i,o){1&i&&e._UZ(0,"button",65)}const wt=function(){return{width:"100%"}};function Tt(i,o){if(1&i){const t=e.EpF();e.TgZ(0,"form",55),e.NdJ("ngSubmit",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.submit())}),e.TgZ(1,"div",18)(2,"div",19)(3,"div",56)(4,"label",57),e._uU(5,"Approval Type"),e.qZA(),e._UZ(6,"p-dropdown",58)(7,"app-error-msg",23),e.qZA(),e.TgZ(8,"div",59)(9,"label",60),e._uU(10,"Notes"),e.qZA(),e._UZ(11,"textarea",26)(12,"app-error-msg",23),e.qZA()()(),e.TgZ(13,"div",61)(14,"div",62),e.YNc(15,yt,1,0,"button",63),e.qZA(),e.TgZ(16,"div",62)(17,"button",64),e.NdJ("click",function(){e.CHM(t);const s=e.oxw();return e.KtG(s.resetForm())}),e.qZA()()()()}if(2&i){const t=e.oxw();e.Q6J("formGroup",t.approvalForm),e.xp6(6),e.Akn(e.DdM(8,wt)),e.Q6J("options",t.approvaltypes)("showClear",!1),e.xp6(1),e.Q6J("control",t.approvalForm.get("approvaltype")),e.xp6(5),e.Q6J("control",t.approvalForm.get("notes")),e.xp6(3),e.Q6J("ngIf",t.isapprovepage&&t.canapprove)}}const be=function(){return{width:"95vw",height:"90vh"}};let F=((Z=class{get f(){return this.mBookForm?.controls}get t(){return this.f.documents}get fileListd(){return this.t.controls}constructor(o,t,n,s,a,c,d,U,q,I,It){this.mbookFacade=o,this.messageService=t,this.confirmationService=n,this.location=s,this.router=a,this.route=c,this.generalService=d,this.tenderService=U,this.formBuilder=q,this.http=I,this.sanitizer=It,this.title="M-Book View",this.isapprovepage=!1,this.canapprove=!1,this.filesList=[],this.showViewer=!1,this.fileType=null,this.Qualityfiletypes=[{text:"Quality Testing Document",value:"MBookTestingDocument"},{text:"Other Doc",value:"MBookOtherDoc"}],this.fileerror=!1,this.fileselected=!1}ngOnInit(){this.mbookFacade.updateApproveStatus(),this.route.params.pipe((0,m.t)(this)).subscribe(o=>{this.mBookId=o.id,this.isapprovepage=o.isapprove,this.mBookId&&(this.mbookFacade.getmbookbyId(this.mBookId),this.mbookFacade.getApprovalTypes(this.mBookId)),this.title=this.isapprovepage?"M-Book Review":"M-Book View"}),this.mbookFacade.selectMBookbyId$.pipe((0,m.t)(this)).subscribe(o=>{o&&(this.mBookDetails=o,this.getMilestoneFiles(this.mBookDetails.workTemplateMilestoneId),this.canapprove=this.mBookDetails.isActionable,this.mBookDetails.files&&(this.generateDefaultRows(this.mBookDetails.files),this.setvaluesofortheForm()))}),this.mbookFacade.selectapprovaltypes$.pipe((0,m.t)(this)).subscribe(o=>{o&&(this.approvaltypes=o)}),this.mbookFacade.selectapprovestatus$.pipe((0,m.t)(this)).subscribe(o=>{!o||o.Status!=M.cH&&o.Status!=M.nQ?o&&(this.messageService.add({severity:"success",summary:"Success",detail:o?.message}),this.mbookFacade.updateApproveStatus(),this.location.back()):this.messageService.add({severity:"error",summary:"Error",life:8e4,detail:o.message})}),this.mBookForm=new r.cw({id:new r.NI(this.mBookId),date:new r.NI("",[r.kI.required]),actuals:new r.NI("",[r.kI.required]),notes:new r.NI("",[r.kI.required]),name:new r.NI("",[r.kI.required]),documents:new r.Oe([])}),this.approvalForm=new r.cw({id:new r.NI(this.mBookId),notes:new r.NI("",[r.kI.required]),approvaltype:new r.NI("",[r.kI.required]),name:new r.NI("",[r.kI.required])})}getQualityFileText(o){const t=this.Qualityfiletypes.find(n=>n.value===o);return t?t.text:o}generateDefaultRows(o){this.t.clear(),o&&o.forEach(t=>{this.t.push(this.formBuilder.group({id:[t.id],type:[t.type,[r.kI.required]],typeName:[t.typeName,[r.kI.required]],originalFileName:[t.originalFileName],savedFileName:[t.savedFileName],fileType:[t.fileType],typeId:[this.mBookId,[r.kI.required]],savedDate:[t.createdDate],savedby:[t.createdByUserName],savedbyrole:[t.createdbyRole],savedbyuserdivision:[t.createdbydivion]}))})}setvaluesofortheForm(){this.mBookForm.get("date")?.patchValue(this.mBookDetails?.date?ie(this.mBookDetails?.date).toDate():null),this.mBookForm.get("actuals")?.patchValue(this.mBookDetails?.actualAmount),this.mBookForm.get("notes")?.patchValue(this.mBookDetails?.workNotes)}submit(){this.approvalForm.valid&&this.Otherfiles?.length>0&&oe.i.create().toString(),this.mbookFacade.ApproveMBook({comments:this.approvalForm.get("notes")?.value,mbookId:this.mBookId,statusCode:this.approvalForm.get("approvaltype")?.value,mbookApprovHistoryeId:this.mbookapproveId})}resetForm(){this.mbookFacade.updateApproveStatus(),this.location.back()}back(){this.mbookFacade.updateApproveStatus(),this.location.back()}download(o,t){this.currentFileId=o,this.currentFileName=t,this.generalService.downloads(o,t)}showDocPdf(o,t){this.currentFileId=o,this.currentFileName=t,this.generalService.ViewPdf(o).subscribe(n=>{const s=URL.createObjectURL(n),a=t.split(".").pop()?.toLowerCase();if(["pdf","doc","docx","xls","xlsx","clsx","ppt","pptx","txt"].includes(a))this.fileType="pdf",this.pdfSrc=this.sanitizer.bypassSecurityTrustResourceUrl(s);else if(["png","jpg","jpeg","gif","bmp","webp"].includes(a))this.fileType="image",this.imgSrc=this.sanitizer.bypassSecurityTrustResourceUrl(s);else{if(!["mp4","webm","ogg"].includes(a))return void console.warn("Unsupported file type:",a);this.fileType="video",this.videoSrc=this.sanitizer.bypassSecurityTrustResourceUrl(s)}this.showViewer=!0})}ngOnDestroy(){this.mbookFacade.reset()}dc(o){return(0,h.ql)(o)}dcwt(o){return(0,h.gv)(o)}getMilestoneFiles(o){this.tenderService.MilestoneFiles(o).subscribe(t=>{t&&(this.filesList=t.data)})}showFileInPopup(o,t){this.currentFileId=o,this.currentFileName=t,this.generalService.ViewPdf(o).subscribe(n=>{const s=URL.createObjectURL(n),a=t.split(".").pop()?.toLowerCase();if(["pdf","doc","docx","xlsx","xls","clxs","ppt","pptx","txt"].includes(a))this.fileType="pdf",this.pdfSrc=this.sanitizer.bypassSecurityTrustResourceUrl(s);else if(["png","jpg","jpeg","gif","bmp","webp"].includes(a))this.fileType="image",this.imgSrc=this.sanitizer.bypassSecurityTrustResourceUrl(s);else{if(!["mp4","webm","ogg"].includes(a))return void console.warn("Unsupported file type:",a);this.fileType="video",this.videoSrc=this.sanitizer.bypassSecurityTrustResourceUrl(s)}this.showViewer=!0})}downloadMilestoneFiles(o,t){this.currentFileId=o,this.currentFileName=t,this.generalService.downloads(o,t??"File.png")}DeleteMilestoneFile(o,t){this.tenderService.DeleteMilestoneFile(o,t).subscribe(n=>{n&&n.data&&this.getMilestoneFiles(o)})}convertoWordsIND(o){return(0,h.i7)(o)}onselectfiles(o){this.fileselected=!0,this.Otherfiles=o.currentFiles}}).\u0275fac=function(o){return new(o||Z)(e.Y36(S),e.Y36(v.ez),e.Y36(v.YP),e.Y36(g.Ye),e.Y36(f.F0),e.Y36(f.gz),e.Y36(ne.m),e.Y36(se.$),e.Y36(r.qu),e.Y36(re.eN),e.Y36(ae.H7))},Z.\u0275cmp=e.Xpm({type:Z,selectors:[["app-view-mbook"]],features:[e._Bn([g.rS])],decls:141,vars:45,consts:[[1,"card"],[1,"grid","formgrid",2,"justify-content","space-between","padding","0rem 1rem","margin-bottom","10px"],[1,""],["icon","pi pi-arrow-left",3,"onClick"],[1,"card","p-fluid",2,"padding","20px 20px 20px 20px","background-color","#e6e7ff"],[1,"p-formgrid","grid"],[1,"col-11"],[1,"col-12","row"],[1,"lg:col-4","md:col-4","sm:col-12","boldlabelinsiderow"],[1,"stablediv",2,"padding","20px","margin-bottom","10px","margin-top","10px","text-align","left"],[1,"table","sssdt"],[4,"ngFor","ngForOf"],["styleClass","milestone-popup",3,"visible","modal","dismissableMask","visibleChange"],["pTemplate","header"],[1,"viewer-container"],[4,"ngIf"],[3,"formGroup"],[3,"disabled"],[1,"p-fluid"],[1,"flex","grid","formgrid"],[1,"field","sm:col-12","md:col-6","lg:col-6"],["htmlFor","category"],["formControlName","date","inputId","icon",3,"showIcon"],[3,"control"],["pInputText","","formControlName","actuals","type","text",3,"maxlength"],[1,"field","sm:col-12","md:col-12","lg:col-12"],["rows","2","pInputTextarea","","formControlName","notes"],[1,"row","flex"],[1,"col"],["key","confirm2"],[1,"formgrid","mb-3"],[1,"card","p-fluid",2,"padding-bottom","10px"],[1,"table"],["formArrayName","documents"],[3,"formGroupName",4,"ngFor","ngForOf"],["class","formgrid mb-3",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],["type","button","pButton","","pRipple","","icon","pi pi-arrow-down","pTooltip","Download","title","Download File","styleClass","p-button-text",1,"p-button-text","mr-2",3,"click"],["type","button","pButton","","pRipple","","icon","pi pi-eye","pTooltip","View","title","View File",1,"p-button-text",3,"click"],[1,"header-container"],[1,"header-title","center"],[1,"header-actions"],["type","button","pButton","","icon","pi pi-arrow-down","pTooltip","Download",1,"icon-download-btn",3,"click"],[1,"viewer-content",3,"src"],["alt","Preview",1,"viewer-content",3,"src"],["controls","",1,"viewer-content",3,"src"],[3,"formGroupName"],[4,"ngIf","ngIfElse"],["normalInput",""],[2,"display","flex"],["type","button","pButton","","pRipple","","icon","pi pi-arrow-down","pTooltip","View",1,"p-button-text",3,"click"],["type","button","pButton","","pRipple","","icon","pi pi-eye","pTooltip","View",1,"p-button-text",3,"click"],[3,"colSpan"],[1,"p-formgrid"],[3,"history"],[3,"formGroup","ngSubmit"],[1,"field","sm:col-12","md:col-4","lg:col-3"],["htmlFor","approvaltype"],["optionLabel","text","optionValue","value","placeholder","Select an Option","formControlName","approvaltype",3,"options","showClear"],[1,"field","sm:col-12","md:col-8","lg:col-9"],["htmlFor","notes"],[1,"col-12","flex",2,"margin-top","25px","justify-content","end","flex-wrap","wrap"],[1,"col-12","md:col-2","lg:col-1"],["pButton","","type","submit","label","Submit",4,"ngIf"],["pButton","","type","button","label","Cancel",1,"p-button-secondary",3,"click"],["pButton","","type","submit","label","Submit"]],template:function(o,t){if(1&o&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"h4"),e._uU(4),e.qZA()(),e.TgZ(5,"div",2)(6,"p-button",3),e.NdJ("onClick",function(){return t.back()}),e.qZA()()(),e.TgZ(7,"div",4)(8,"div",5)(9,"div",6)(10,"div",7)(11,"div",8)(12,"span"),e._uU(13,"M-Book Number: "),e.qZA(),e._uU(14),e.qZA(),e.TgZ(15,"div",8)(16,"span"),e._uU(17,"Work Number: "),e.qZA(),e._uU(18),e.qZA(),e.TgZ(19,"div",8)(20,"span"),e._uU(21,"Work Type: "),e.qZA(),e._uU(22),e.qZA(),e.TgZ(23,"div",8)(24,"span"),e._uU(25,"Sub Work Type: "),e.qZA(),e._uU(26),e.qZA(),e.TgZ(27,"div",8)(28,"span"),e._uU(29,"Strength: "),e.qZA(),e._uU(30),e.qZA(),e.TgZ(31,"div",8)(32,"span"),e._uU(33,"Code: "),e.qZA(),e._uU(34),e.qZA(),e.TgZ(35,"div",8)(36,"span"),e._uU(37,"Milestone Name: "),e.qZA(),e._uU(38),e.qZA(),e.TgZ(39,"div",8)(40,"span"),e._uU(41,"District: "),e.qZA(),e._uU(42),e.qZA(),e.TgZ(43,"div",8)(44,"span"),e._uU(45,"Division: "),e.qZA(),e._uU(46),e.qZA(),e.TgZ(47,"div",8)(48,"span"),e._uU(49,"Start Date: "),e.qZA(),e._uU(50),e.qZA(),e.TgZ(51,"div",8)(52,"span"),e._uU(53,"End Date: "),e.qZA(),e._uU(54),e.qZA(),e.TgZ(55,"div",8)(56,"span"),e._uU(57,"Planned Value: "),e.qZA(),e._uU(58),e.qZA()()()(),e.TgZ(59,"div",9)(60,"h5"),e._uU(61,"Milestone Files"),e.qZA(),e.TgZ(62,"table",10)(63,"thead")(64,"tr")(65,"th"),e._uU(66," S. No"),e.qZA(),e.TgZ(67,"th"),e._uU(68," Name"),e.qZA(),e.TgZ(69,"th"),e._uU(70," Saved by"),e.qZA(),e.TgZ(71,"th"),e._uU(72," Saved date"),e.qZA(),e.TgZ(73,"th"),e._uU(74," Download"),e.qZA(),e.TgZ(75,"th"),e._uU(76," View"),e.qZA()()(),e.TgZ(77,"tbody"),e.YNc(78,st,13,4,"tr",11),e.qZA()(),e.TgZ(79,"p-dialog",12),e.NdJ("visibleChange",function(s){return t.showViewer=s}),e.YNc(80,rt,5,0,"ng-template",13),e.TgZ(81,"div",14),e.YNc(82,at,2,1,"ng-container",15),e.YNc(83,lt,2,1,"ng-container",15),e.YNc(84,pt,2,1,"ng-container",15),e.qZA()()()(),e.TgZ(85,"form",16)(86,"fieldset",17)(87,"div",18)(88,"div",19)(89,"div",20)(90,"label",21),e._uU(91,"Date"),e.qZA(),e._UZ(92,"p-calendar",22)(93,"app-error-msg",23),e.qZA(),e.TgZ(94,"div",20)(95,"label",21),e._uU(96,"Amount spent"),e.qZA(),e._UZ(97,"input",24)(98,"app-error-msg",23),e.qZA(),e.TgZ(99,"div",25)(100,"label",21),e._uU(101,"Notes"),e.qZA(),e._UZ(102,"textarea",26)(103,"app-error-msg",23),e.qZA()()(),e.TgZ(104,"div",27)(105,"div",28)(106,"h5"),e._uU(107,"Documents "),e.qZA()()(),e._UZ(108,"p-confirmPopup",29),e.qZA(),e.TgZ(109,"div",30)(110,"div",31)(111,"div",5)(112,"table",32)(113,"thead")(114,"tr")(115,"th"),e._uU(116,"S.No"),e.qZA(),e.TgZ(117,"th"),e._uU(118,"Document Type"),e.qZA(),e.TgZ(119,"th"),e._uU(120,"Uploaded by"),e.qZA(),e.TgZ(121,"th"),e._uU(122,"Uploaded Date"),e.qZA(),e.TgZ(123,"th"),e._uU(124,"Uploaded Document Name"),e.qZA(),e.TgZ(125,"th"),e._uU(126,"Download"),e.qZA(),e.TgZ(127,"th"),e._uU(128,"View"),e.qZA()()(),e.TgZ(129,"tbody",33),e.YNc(130,mt,18,9,"tr",34),e.YNc(131,gt,3,1,"tr",15),e.qZA()(),e.TgZ(132,"p-dialog",12),e.NdJ("visibleChange",function(s){return t.showViewer=s}),e.YNc(133,ht,5,0,"ng-template",13),e.TgZ(134,"div",14),e.YNc(135,ft,2,1,"ng-container",15),e.YNc(136,vt,2,1,"ng-container",15),e.YNc(137,bt,2,1,"ng-container",15),e.qZA()()()()()(),e.YNc(138,_t,2,0,"h5",15),e.YNc(139,kt,4,1,"div",35),e.YNc(140,Tt,18,9,"form",36),e.qZA()),2&o){let n,s;e.xp6(4),e.Oqu(t.title),e.xp6(10),e.hij("",t.mBookDetails&&t.mBookDetails.mBookNumber?t.mBookDetails.mBookNumber:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.tenderNumber?t.mBookDetails.tenderNumber:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.workType?t.mBookDetails.workType:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.subWorkType?t.mBookDetails.subWorkType:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.strength?t.mBookDetails.strength:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.milestoneCode?t.mBookDetails.milestoneCode:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.milestoneName?t.mBookDetails.milestoneName:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.districtName?t.mBookDetails.districtName:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.divisionName?t.mBookDetails.divisionName:""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.startDate?t.dc(t.mBookDetails.startDate):""," "),e.xp6(4),e.hij("",t.mBookDetails&&t.mBookDetails.endDate?t.dc(t.mBookDetails.endDate):""," "),e.xp6(4),e.AsE("",t.mBookDetails&&t.mBookDetails.milestoneAmount?t.mBookDetails.milestoneAmount:""," ",t.mBookDetails&&t.mBookDetails.milestoneAmount?" ("+t.convertoWordsIND(t.mBookDetails.milestoneAmount)+")":""," "),e.xp6(20),e.Q6J("ngForOf",t.filesList),e.xp6(1),e.Akn(e.DdM(43,be)),e.Q6J("visible",t.showViewer)("modal",!0)("dismissableMask",!0),e.xp6(3),e.Q6J("ngIf","pdf"===t.fileType),e.xp6(1),e.Q6J("ngIf","image"===t.fileType),e.xp6(1),e.Q6J("ngIf","video"===t.fileType),e.xp6(1),e.Q6J("formGroup",t.mBookForm),e.xp6(1),e.Q6J("disabled",!0),e.xp6(6),e.Q6J("showIcon",!0),e.xp6(1),e.Q6J("control",t.mBookForm.get("date")),e.xp6(4),e.Q6J("maxlength",10),e.xp6(1),e.Q6J("control",t.mBookForm.get("actuals")),e.xp6(5),e.Q6J("control",t.mBookForm.get("notes")),e.xp6(27),e.Q6J("ngForOf",t.t.controls),e.xp6(1),e.Q6J("ngIf",!t.t.controls),e.xp6(1),e.Akn(e.DdM(44,be)),e.Q6J("visible",t.showViewer)("modal",!0)("dismissableMask",!0),e.xp6(3),e.Q6J("ngIf","pdf"===t.fileType),e.xp6(1),e.Q6J("ngIf","image"===t.fileType),e.xp6(1),e.Q6J("ngIf","video"===t.fileType),e.xp6(1),e.Q6J("ngIf",(null==t.mBookDetails?null:t.mBookDetails.approvalHistory)&&null!==(n=null==t.mBookDetails||null==t.mBookDetails.approvalHistory?null:t.mBookDetails.approvalHistory.length)&&void 0!==n&&n),e.xp6(1),e.Q6J("ngIf",(null==t.mBookDetails?null:t.mBookDetails.approvalHistory)&&null!==(s=null==t.mBookDetails||null==t.mBookDetails.approvalHistory?null:t.mBookDetails.approvalHistory.length)&&void 0!==s&&s),e.xp6(1),e.Q6J("ngIf",t.isapprovepage&&t.canapprove)}},dependencies:[g.sg,g.O5,r._Y,r.Fj,r.JJ,r.JL,r.nD,v.jx,le.f,B.Hq,B.zx,pe.o,ce.Lt,de.g,r.sg,r.u,r.x0,r.CE,ue.u,me.P,ge.V,fe.u,nt.N],styles:[".boldlabel[_ngcontent-%COMP%] > span[_ngcontent-%COMP%]{font-weight:700}.boldlabelinsiderow[_ngcontent-%COMP%]{padding:10px!important}.boldlabelinsiderow[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:700}.boldlabelhiegr[_ngcontent-%COMP%]{padding:0!important}.boldlabelhiegr[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:650;font-size:13px}.sssdt[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .sssdt[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{background-color:#e6e7ff;padding:10px}.stablediv[_ngcontent-%COMP%]{padding:15px;background-color:#e6e7ff;border-radius:10px}.iconstyling[_ngcontent-%COMP%]{padding:10px;border-radius:5px;background-color:#aaf}  .p-card .p-card-content{padding:.25rem 0}  .p-card .p-card-title{font-size:1 rem}  .setheight{min-height:599px;max-height:600px;overflow:auto}  .sddd{min-height:599px;max-height:600px}  .colr{background-color:#00f}  .milestone-popup .p-dialog{border-radius:0!important;background-color:#f5f7fa!important;border:2px solid #cfd8dc!important}.header-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;width:100%}.header-title[_ngcontent-%COMP%]{font-size:22px;font-weight:700;color:#121212}.header-actions[_ngcontent-%COMP%]{display:flex;align-items:center;gap:6px}  .milestone-popup .p-dialog-header{background-color:#e9ebec!important;padding:.75rem 1rem}.icon-download-btn[_ngcontent-%COMP%]{background-color:transparent!important;border:none!important;width:36px!important;height:36px!important;border-radius:50%!important;padding:0!important;display:flex;align-items:center;justify-content:center;cursor:pointer}.icon-download-btn[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{font-size:1.1rem;color:#070707}.close-btn[_ngcontent-%COMP%]{background:transparent!important;border:none!important;color:#e51717!important}.viewer-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:calc(90vh - 70px)}.viewer-content[_ngcontent-%COMP%]{max-width:100%;max-height:100%;object-fit:contain;border:none}.viewer-container[_ngcontent-%COMP%]   iframe[_ngcontent-%COMP%], .viewer-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;border:none}.viewer-container[_ngcontent-%COMP%]   video[_ngcontent-%COMP%]{width:100%;height:100%;border:none}"]}),Z);F=(0,A.gn)([(0,m.c)()],F);const Ct=[{path:"",component:N},{path:":type",component:N},{path:"edit/:id",component:D},{path:"view/:id/:isapprove",component:F},{path:"view/:id",component:F}];let Zt=(()=>{var i;class o{}return(i=o).\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.Bz.forChild(Ct),f.Bz]}),o})();var Mt=p(68352),Bt=p(9502),xt=p(97680),_e=p(39232),St=p(74104),Nt=p(44393),Ft=p(30442),u=p(16465),_=p(22096),k=p(67634),y=p(37398),w=p(26306),At=p(63316),Dt=p(30505);let Ut=(()=>{var i;class o{constructor(n,s,a){this.actions$=n,this.mBookService=s,this.twoColConfigService=a,this.getmbooks$=(0,u.GW)(()=>this.actions$.pipe((0,u.l4)(O),(0,k.z)(({mbookFiletr:c})=>this.mBookService.getMBooks(c).pipe((0,y.U)(d=>J({mbooks:d})),(0,w.K)(d=>(0,_.of)()))))),this.getAllDivisions$=(0,u.GW)(()=>this.actions$.pipe((0,u.l4)(Y),(0,k.z)(({})=>this.twoColConfigService.getAllDivisions().pipe((0,y.U)(c=>E({divisions:c.data})),(0,w.K)(c=>(0,_.of)()))))),this.getmbookbyId$=(0,u.GW)(()=>this.actions$.pipe((0,u.l4)(x),(0,k.z)(({id:c})=>this.mBookService.getMBookbyId(c).pipe((0,y.U)(d=>L({mbook:d.data})),(0,w.K)(d=>(0,_.of)()))))),this.getFileTypes$=(0,u.GW)(()=>this.actions$.pipe((0,u.l4)(G),(0,k.z)(({})=>this.mBookService.getFileTypes().pipe((0,y.U)(c=>j({filetypes:c.data})),(0,w.K)(c=>(0,_.of)()))))),this.getApprovalTypes$=(0,u.GW)(()=>this.actions$.pipe((0,u.l4)(H),(0,k.z)(({mbookId:c})=>this.mBookService.getApprovalTypes(c).pipe((0,y.U)(d=>R({approvaltypes:d.data})),(0,w.K)(d=>(0,_.of)()))))),this.savembook$=(0,u.GW)(()=>this.actions$.pipe((0,u.l4)(V),(0,k.z)(({mbook:c})=>this.mBookService.saveMbook(c).pipe((0,y.U)(d=>Q({mbook:d})),(0,w.K)(d=>(0,_.of)()))))),this.approveMbook$=(0,u.GW)(()=>this.actions$.pipe((0,u.l4)(z),(0,k.z)(({mbook:c})=>this.mBookService.approveMbook(c).pipe((0,y.U)(d=>$({mbook:d})),(0,w.K)(d=>(0,_.of)())))))}}return(i=o).\u0275fac=function(n){return new(n||i)(e.LFG(u.eX),e.LFG(At.B),e.LFG(Dt.g))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac}),o})(),qt=(()=>{var i;class o{}return(i=o).\u0275fac=function(n){return new(n||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[S],imports:[g.ez,Zt,Ft.W,_e.U$,B.hJ,xt.L,Nt.r,Bt.$,l.Aw.forFeature(ee,ye),u.sQ.forFeature([Ut]),St.EV,_e.U$,he.O,Mt._t]}),o})()}}]);